# 現在時間MCPサーバー 要件定義書

## 1. プロジェクト概要

### 1.1 目的
AIアシスタントが現在の日時情報を取得するためのMCP（Model Context Protocol）サーバーを提供する。

### 1.2 スコープ
- 現在の日時を取得するAPIの提供
- 複数のタイムゾーンに対応
- ISO 8601フォーマットでの出力

## 2. 機能要件

### 2.1 基本機能
- **F001**: 現在の日時を取得する
- **F002**: 指定されたタイムゾーンでの日時を取得する

### 2.2 機能詳細

#### F001: 現在の日時を取得
- システムの現在日時をUTC+9（JST）で取得
- 出力フォーマット：ISO 8601

#### F002: タイムゾーン指定
- サポートタイムゾーン：UTC、JST、EST、PST、GMT
- IANA timezone database形式もサポート

## 3. 入出力仕様

### 3.1 ツール定義
```json
{
  "name": "getCurrentTime",
  "description": "現在の日時を取得します",
  "inputSchema": {
    "type": "object",
    "properties": {
      "timezone": {
        "type": "string",
        "description": "タイムゾーン (例: Asia/Tokyo, UTC, America/New_York)",
        "default": "Asia/Tokyo"
      },
      "format": {
        "type": "string",
        "description": "出力フォーマット (iso, rfc, custom)",
        "enum": ["iso", "rfc", "custom"],
        "default": "iso"
      },
      "customFormat": {
        "type": "string",
        "description": "カスタムフォーマット (format='custom'の場合に使用)",
        "default": "YYYY-MM-DD HH:mm:ss"
      }
    }
  }
}
```

### 3.2 出力形式
```json
{
  "content": [
    {
      "type": "text",
      "text": "2025-06-18T15:30:45+09:00"
    }
  ]
}
```

## 4. 非機能要件

### 4.1 性能要件
- レスポンス時間：100ms以内
- 同時処理：最大10リクエスト/秒

### 4.2 可用性要件
- サーバー稼働率：99.9%以上

### 4.3 保守性要件
- TypeScript実装
- 単体テストカバレッジ：100%

## 5. 制約事項

### 5.1 技術的制約
- Node.js 18以上
- @modelcontextprotocol/sdk使用
- zodによるスキーマバリデーション

### 5.2 運用制約
- システムローカル時間に依存
- タイムゾーンデータの更新は手動

## 6. セキュリティ要件

### 6.1 認証・認可
- MCPプロトコルの標準認証に準拠

### 6.2 入力検証
- 不正なタイムゾーン文字列の検証
- SQLインジェクション等の対策は不要（DBアクセスなし）

## 7. エラーハンドリング

### 7.1 エラーケース
- 無効なタイムゾーン指定
- 無効なフォーマット指定
- システム時刻取得エラー

### 7.2 エラーレスポンス
```json
{
  "error": {
    "code": "INVALID_TIMEZONE",
    "message": "指定されたタイムゾーンは無効です: InvalidZone"
  }
}
```

## 8. テストケース

### 8.1 正常系テストケース

#### TC001: デフォルト実行
- **入力**: パラメータなし
- **期待値**: Asia/Tokyo、ISO形式での現在時刻
- **検証項目**: 
  - ISO 8601形式であること
  - タイムゾーンが+09:00であること

#### TC002: タイムゾーン指定
- **入力**: `{"timezone": "UTC"}`
- **期待値**: UTC時刻がISO形式で出力
- **検証項目**: タイムゾーンが+00:00であること

#### TC003: フォーマット指定
- **入力**: `{"format": "rfc"}`
- **期待値**: RFC 2822形式での現在時刻
- **検証項目**: RFC 2822形式であること

#### TC004: カスタムフォーマット
- **入力**: `{"format": "custom", "customFormat": "YYYY-MM-DD"}`
- **期待値**: 日付のみ（YYYY-MM-DD形式）
- **検証項目**: 指定形式で出力されること

#### TC005: 複合パラメータ
- **入力**: `{"timezone": "America/New_York", "format": "custom", "customFormat": "HH:mm:ss"}`
- **期待値**: NY時刻で時刻のみ
- **検証項目**: EST/EDTタイムゾーンで正しく出力されること

### 8.2 異常系テストケース

#### TC101: 無効タイムゾーン
- **入力**: `{"timezone": "Invalid/Zone"}`
- **期待値**: エラーレスポンス
- **検証項目**: 
  - error.code = "INVALID_TIMEZONE"
  - 適切なエラーメッセージ

#### TC102: 無効フォーマット
- **入力**: `{"format": "invalid"}`
- **期待値**: エラーレスポンス
- **検証項目**: 
  - error.code = "INVALID_FORMAT"
  - 適切なエラーメッセージ

#### TC103: カスタムフォーマット未指定
- **入力**: `{"format": "custom"}`（customFormatなし）
- **期待値**: デフォルトカスタムフォーマットで実行
- **検証項目**: "YYYY-MM-DD HH:mm:ss"形式で出力

#### TC104: 空パラメータ
- **入力**: `{}`（空オブジェクト）
- **期待値**: デフォルト設定で実行成功
- **検証項目**: デフォルト値が適用されること

### 8.3 境界値テストケース

#### TC201: 年末年始の時刻
- **条件**: 12月31日23:59:59と1月1日00:00:00付近での実行
- **検証項目**: 日付の切り替わりが正しく処理されること

#### TC202: うるう年の2月29日
- **条件**: うるう年の2月29日での実行
- **検証項目**: 正しく処理されること

#### TC203: 夏時間切り替え時刻
- **条件**: 夏時間開始/終了日での実行
- **検証項目**: タイムゾーン変換が正しく処理されること

#### TC204: 最大長文字列
- **入力**: 非常に長いカスタムフォーマット文字列
- **検証項目**: 適切に処理されるかエラーになること

### 8.4 パフォーマンステストケース

#### TC301: 連続実行
- **条件**: 10回連続実行
- **検証項目**: 各実行が100ms以内に完了すること

#### TC302: 同時実行
- **条件**: 10並列実行
- **検証項目**: すべて正常完了すること